- name: Install basic consumer tools (apt)
  apt:
    name:
    - xournal
  become: yes

- name: Install basic consumer tools (snap)
  snap:
    name:
    - vlc
  become: yes

- name: Install Google Chrome
  import_role:
    name: cmprescott.chrome
  become: yes

- name: Set Google Chrome as the default browser
  shell: |
    xdg-settings set default-web-browser google-chrome.desktop
    kwriteconfig5 --file kdeglobals --group General --key 'BrowserApplication' google-chrome.desktop
    xdg-mime default google-chrome.desktop x-scheme-handler/http
    xdg-mime default google-chrome.desktop x-scheme-handler/https

- name: Fetch Zoom's version details
  uri:
    url: https://zoom.us/rest/download?os=linux
  register: zoom_version_details_response

- name: Find Zoom's latest version
  set_fact:
    zoom_latest_version: "{{zoom_version_details_response.json.result.downloadVO.zoom.version}}"

- name: Find Zoom's current version
  shell: "dpkg -s zoom | grep '^Version:' | cut -d ' ' -f 2-"
  register: check_zoom_current_version

- name: Decide if should reinstall Zoom
  set_fact:
    should_reinstall_zoom: "{{ check_zoom_current_version.stdout == "" or check_zoom_current_version.stdout is version(zoom_latest_version, '<') }}"

- name: Install Zoom
  apt:
    deb: https://zoom.us/client/latest/zoom_{{packages_architecture}}.deb
  become: yes
  when: should_reinstall_zoom

- name: Install Slack
  snap:
    name: slack
    classic: yes
  become: yes
  when: computer_type == "work"