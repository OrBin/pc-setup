---
# TODO: recent python version/pyenv, golang, setup Python venv

- name: Download GitHub CLI GPG key public ring
  get_url:
    url: https://cli.github.com/packages/githubcli-archive-keyring.gpg
    dest: /usr/share/keyrings/githubcli-archive-keyring.gpg
    mode: '0644'
  become: yes

- name: Add GitHub CLI apt repository into sources list
  apt_repository:
    repo: "deb [arch={{packages_architecture}} signed-by=/usr/share/keyrings/githubcli-archive-keyring.gpg] https://cli.github.com/packages stable main"
    filename: /etc/apt/sources.list.d/github-cli.list
    update_cache: yes
  become: yes

- name: Install developer tools (apt)
  apt:
    name:
    - gh
    - git
    - nmap
    - wireshark
  become: yes

- name: Evaluate completion for GitHub CLI
  shell: gh completion -s bash
  register: gh_completion

- name: Add GitHub CLI completion to bash configuration
  blockinfile:
    block: "{{gh_completion.stdout}}"
    path: "{{bash_configuration_file_path}}"

- name: Install developer tools (snap)
  snap:
    name:
    - doctl
  become: yes

- name: Connect doctl to ssh-keys interface
  shell: snap connect doctl:ssh-keys :ssh-keys
  become: yes

- name: Install Docker
  import_role:
    name: geerlingguy.docker
  vars:
    docker_compose_version: "1.29.2"
    docker_apt_arch: "{{packages_architecture}}"
    docker_users:
      - "{{ansible_user_id}}"  # Self user (the user running this setup)
  become: yes

- name: Install dive
  apt:
    deb: "https://github.com/wagoodman/dive/releases/download/v{{dive_version}}/dive_{{dive_version}}_linux_{{packages_architecture}}.deb"
  become: yes

- name: Install JetBrains IDEs
  snap:
    name:
      - pycharm-professional
      - goland
    classic: yes
  become: yes

- name: Install Postman
  snap:
    name: postman
    channel: "{{postman_snap_channel}}"
  become: yes

- name: Download and extract AWS CLI
  unarchive:
    src: "https://awscli.amazonaws.com/awscli-exe-linux-{{ansible_architecture}}.zip"
    dest: "{{temp_dir}}"
    remote_src: yes
  register: unarchive_awscli

- name: Install AWS CLI
  shell: "{{unarchive_awscli.dest}}/aws/install --update"
  become: yes

- name: Install NodeJS
  import_role:
    name: geerlingguy.nodejs
  vars:
    nodejs_version: "16.x"
  become: yes

- name: Install diff-so-fancy
  npm:
    name: diff-so-fancy
    global: yes
  become: yes

- name: Configure diff-so-fancy in git config
  git_config:
    name: "{{ item.key }}"
    value: "{{ item.value }}"
    scope: global
  loop: "{{ config | dict2items }}"
  vars:
    config:
      core.pager: "diff-so-fancy | less --tabs=4 -RFX"
      interactive.diffFilter: "diff-so-fancy --patch"
      color.ui: "true"
      color.diff-highlight.oldNormal: "red bold"
      color.diff-highlight.oldHighlight: "red bold 52"
      color.diff-highlight.newNormal: "green bold"
      color.diff-highlight.newHighlight: "green bold 22"
      color.diff.meta: "11"
      color.diff.frag: "magenta bold"
      color.diff.func: "146 bold"
      color.diff.commit: "yellow bold"
      color.diff.old: "red bold"
      color.diff.new: "green bold"
      color.diff.whitespace: "red reverse"
